---
title: "Describing a Wine"
author: "Ellis Hughes"
date: "June 14, 2018"
output:
  html_document:
    keep_md: yes
---

After the grape type and winery, the descriptions are the huge part of the wine purchasing process. Usually these descriptions draw from the ["Wine Aroma Wheel"](https://wcicdn-thewinecellarins.netdna-ssl.com/wp-content/uploads/2010/05/Davis-Wine-Aroma-Wheel1.jpg) developed at UC Davis. It categorizes the scents wines can have, from the pleasant to the less so.

In this analysis I will be using the "tidytext" packge developed by David Robinson and Julia Silge to see if I can find insight in how wines are described across varietals. As in my prior analysis of wine, the data used for this analysis can be found in csv generated by [Zack Thoutt]("https://www.kaggle.com/zynicide/wine-reviews/data").


```r
library(knitr)
library(tidyverse)
```

```
## -- Attaching packages ------------------------------------------------------- tidyverse 1.2.1 --
```

```
## v ggplot2 2.2.1     v purrr   0.2.4
## v tibble  1.4.2     v dplyr   0.7.5
## v tidyr   0.8.1     v stringr 1.3.1
## v readr   1.1.1     v forcats 0.3.0
```

```
## -- Conflicts ---------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
```

```r
library(tidytext)
library(tokenizers)
opts_chunk$set(echo = TRUE,message=FALSE,warning=FALSE)
wineData<-read.csv("../winemag-data-130k-v2.csv",header = TRUE,stringsAsFactors = FALSE)
```

#The Breakdown

After reading in the csv, I performed some basic filtering to make sure we didnt have any countries or varietals that were too rare. each country needed a minumum of 500 representatives, and each variatal 300. This left me with 113601 observations.

Next, the unnest_tokens was used to split the descriptions into individual words and any stop words were removed. 


```r
wineData_filtered<-wineData%>%
  group_by(country)%>%
  filter(n()>500)%>%
  ungroup()%>%
  group_by(variety)%>%
  filter(n()>300)%>%
  ungroup()%>%
  select(-X,-taster_twitter_handle)

wineData_TidyDescriptions<-wineData_filtered%>%
  unnest_tokens(word, description)%>%
    anti_join(get_stopwords())
```

The top counted words remaining make sense, as the word "wine", when describing wine, is logical. And since the desciption is for describing the taste and smell of the wine, much more refined words such as "flavors" and "aromas" are used. Fruit is a common word in describing wine, as it is a desireable quality, so it finds itself as the third most commonly used word in descriptions. 


```r
wineData_TidyDescriptions %>%
  count(word, sort = TRUE) 
```

```
## # A tibble: 32,884 x 2
##    word        n
##    <chr>   <int>
##  1 wine    69028
##  2 flavors 54914
##  3 fruit   43378
##  4 aromas  32575
##  5 palate  31979
##  6 acidity 30243
##  7 finish  29529
##  8 tannins 27722
##  9 drink   27053
## 10 cherry  26055
## # ... with 32,874 more rows
```

# Description By Varietal

I removed some of the generic words from the set, which showed up commonly in the descriptions in general such as "wine", in an effort to find the actual descriptors of the wine. 

Looking at the results, the words that I think of when I think of a varietal are common descriptors. Chardonnay was described with words like fruit, apple, oak and  Merlot as cherry, tannins, black, and finish. If this is what the wine makers are going for, they succeeded! 


```r
wineData_TidyDescriptions %>%
  filter(!word%in%c("wine","flavors","aromas","drink"))%>%
  group_by(variety)%>%
  count(word,sort=TRUE)%>%
  {
    uniqueWines<-unique(.$variety)
    top5wordsMatrix<-data.frame(matrix(NA,ncol=5,nrow=length(uniqueWines)),row.names = uniqueWines)
    colnames(top5wordsMatrix)<-c("Word1","Word2","Word3","Word4","Word5")
    for(var in uniqueWines){
      tmp<-.[.$variety==var,"word"]%>%filter(!toupper(word)%in%toupper(strsplit(var," ")[[1]]))%>%unlist
      top5wordsMatrix[var,]<-tmp[1:5]
    }
    return(top5wordsMatrix)
  }%>%
  mutate(wine=rownames(.))%>%
  arrange(wine)%>%
  select(wine,Word1,Word2,Word3,Word4,Word5)
```

```
##                             wine     Word1    Word2    Word3      Word4
## 1                      Aglianico     black  tannins   palate     cherry
## 2                      AlbariÃ±o    finish    apple   palate     citrus
## 3                        Barbera     black   cherry    fruit     palate
## 4       Bordeaux-style Red Blend   tannins    fruit    black   cabernet
## 5     Bordeaux-style White Blend   acidity     ripe    fruit      crisp
## 6                 Cabernet Franc    cherry  tannins    fruit        red
## 7             Cabernet Sauvignon     black  tannins    fruit     cherry
## 8                     CarmenÃ¨re    herbal   finish    berry     palate
## 9                Champagne Blend   acidity    crisp     ripe      fruit
## 10                    Chardonnay   acidity    fruit    apple        oak
## 11                  Chenin Blanc   acidity    apple    fruit        now
## 12 Corvina, Rondinella, Molinara     fruit    spice   cherry    amarone
## 13                         Gamay   acidity  tannins      red     fruits
## 14                      Garnacha    finish     plum   palate      berry
## 15               GewÃ¼rztraminer    palate      dry    fruit      sweet
## 16                         Glera     white    peach  acidity      apple
## 17             GrÃ¼ner Veltliner    palate     pear    fruit      fresh
## 18                      Grenache    cherry    fruit      red     palate
## 19                        Malbec    finish    berry    fruit      black
## 20                        Merlot     fruit   cherry  tannins      black
## 21                       Moscato     sweet    peach    honey      fruit
## 22                      Nebbiolo   tannins   palate   cherry      berry
## 23                  Nero d'Avola    cherry    black   palate    tannins
## 24                  Petite Sirah     black  tannins    fruit blackberry
## 25                   Pinot Blanc     apple    fruit   palate      fresh
## 26                  Pinot Grigio   acidity    apple    white      fruit
## 27                    Pinot Gris      pear    fruit   palate      apple
## 28                    Pinot Noir    cherry    fruit  acidity        red
## 29                          Port   acidity    fruit     ripe    tannins
## 30                Portuguese Red   tannins   fruits  acidity       ripe
## 31              Portuguese White   acidity    crisp     ripe        now
## 32                     Red Blend     black   palate   cherry    tannins
## 33        RhÃ´ne-style Red Blend     fruit    syrah grenache      black
## 34      RhÃ´ne-style White Blend roussanne    blanc viognier   grenache
## 35                      Riesling       dry   palate   finish    acidity
## 36                         RosÃ©   acidity      red     rosã      fruit
## 37                    Sangiovese    cherry   palate  tannins      black
## 38             Sangiovese Grosso     fruit brunello   cherry      spice
## 39                     Sauvignon     fruit   palate  acidity     tomato
## 40               Sauvignon Blanc     fruit  acidity   finish      green
## 41                        Shiraz     fruit   finish    notes    tannins
## 42               Sparkling Blend     apple   palate   finish        dry
## 43                         Syrah     fruit    black   finish     pepper
## 44                   Tempranillo    finish    berry     plum     palate
## 45             Tempranillo Blend    finish    berry     plum     palate
## 46                      Viognier     fruit   finish    peach     palate
## 47                   White Blend     fruit   palate  acidity     finish
## 48                     Zinfandel     fruit      zin    black blackberry
##        Word5
## 1      spice
## 2      peach
## 3    acidity
## 4       ripe
## 5  character
## 6      black
## 7     finish
## 8       plum
## 9        dry
## 10      ripe
## 11      ripe
## 12     sweet
## 13    cherry
## 14    cherry
## 15    finish
## 16    palate
## 17      ripe
## 18    finish
## 19    palate
## 20    finish
## 21    palate
## 22     spice
## 23     fruit
## 24      dark
## 25   acidity
## 26    citrus
## 27    finish
## 28   tannins
## 29      rich
## 30     black
## 31    fruity
## 32     fruit
## 33    finish
## 34    finish
## 35     lemon
## 36     crisp
## 37     fruit
## 38    bright
## 39     white
## 40    citrus
## 41    bodied
## 42   acidity
## 43    palate
## 44     fruit
## 45       oak
## 46   acidity
## 47     apple
## 48    cherry
```

# sentiment vs score

I was now curious if the writers seniment would change when you give a wine a higher or lower score. Overall, surprisingly once the wine reached a certain point, the reviewers could only be so positive. Unless, of course, the wine was perfect. In whichcase, the reviewer had very little negative comments. 

We must also remember that sentiment analysis did no take into account conditioning words such as not or no. Also, some flavor descriptors are found to be negative in sentiment that is actually positve, such as "lemon". 


```r
bing <- get_sentiments("bing")

wine_sentiments<-wineData_TidyDescriptions %>%
  inner_join(bing) %>%
  filter(!word%in%c("wine","flavors","aromas","drink"))%>%
  mutate(points=factor(as.character(points),levels = unique(as.numeric(as.character(points)))),
         sentiment_positive=ifelse(sentiment=="positive",1,-1))%>%
  group_by(points)%>%
  summarise(sentiment_positive=mean(sentiment_positive))%>%
  mutate(points=as.numeric(as.character(points)))%>%
  arrange(points)

ggplot(wine_sentiments,aes(x=points,y=sentiment_positive))+
  geom_point(aes(color=I("blue")))+
  geom_hline(yintercept = 0)+
  geom_smooth()+
  geom_text(aes(x=95,y=.025,label="Neutral Sentiment"))+
  ggtitle("Average Sentiment by Wine Score")
```

![](Describing_a_wine_files/figure-html/sentiment vs score-1.png)<!-- -->
